      SUBROUTINE COLL
C      SIMULATION MODEL OF AUTOMOBILE COLLISIONS -SMAC
      COMMON/CONST/ G,RAD,PI,TWOPI,PIO2,PI32,ND2,ND4,ND8,NIN,NOUT
      COMMON/INTG/NEQ,T,DT,VAR(12),DER(12)
      EQUIVALENCE (VAR(1),XCP1),(VAR(2),YCP1),(VAR(3),PSI1),
     1            (VAR(4),PSI1D),(VAR(5),U1),(VAR(6),V1),
     2            (VAR(7),XCP2),(VAR(8),YCP2),(VAR(9),PSI2),
     3            (VAR(10),PSI2D),(VAR(11),U2),(VAR(12),V2)
      EQUIVALENCE (DER(1),DXCP1),(DER(2),DYCP1),(DER(3),DPSI1),
     1            (DER(4),DPSI1D),(DER(5),DU1),(DER(6),DV1),
     2            (DER(7),DXCP2),(DER(8),DYCP2),(DER(9),DPSI2),
     3            (DER(10),DPSI2D),(DER(11),DU2),(DER(12),DV2)
      COMMON/INPT/  T0,TF,DTTRA0,DTCOL0,DTCLT0,DTPRN0,UVMIN,PSIDMN,FVEH0
     1             ,XCP10,YCP10,PSI10,PSI1D0,U10,V10,
     2              XCP20,YCP20,PSI20,PSI2D0,U20,V20,
     3              A1,B1,TR1,FIZ1,FM1,PSIR10,XF1,XR1,YS1,
     4              A2,B2,TR2,FIZ2,FM2,PSIR20,XF2,XR2,YS2,
     5              CSTFI(8),TBTQ1,TETQ1,TINCQ1,NTBLQ1,NTQ1,
     6              TBTQ2,TETQ2,TINCQ2,NTBLQ2,NTQ2,TII(8,201),
     7              TBPSF1,TEPSF1,TINCP1,NTBLP1,NPSF1,
     8              TBPSF2,TEPSF2,TINCP2,NTBLP2,NPSF2,PSIFI(4,201),
     9              XBP(2),YBP(2),XMU1,XMU2,CMU
      COMMON/INPT/  DELPS0,DELRO0,ALAMB,ZETAV,AKV(2) ,AMU,C0,C1,C2,
     1              PSLM10,PSLM20,PSLM30,PSLM40,PSLM50,PSLM60,PSLM70,
     2              PSLM80,HED(40),DADE(3),XINPUT(9)
      COMMON/INTGR/JCC(4),JCOR(4),NPSIB,IPSIB0,IPSIB,IBB,IFF,NDTAB,
     1             I9,J9(361,2),  NPSJB,IPSJB,I3,ILAST,IL,IND1,IND2,INDI
     2             ,INDJ,ISTOP,ITZER1,ITZER2,IPZER1,IPZER2,ICOUNT,INDXB,
     3             ICOLLP,ICOLL,IQ,IND,IVEH,LL,ICTVDI,ITCOL,ITFLG1,
     4             ITFLG2,NWRDB1,NWRDE1,NWRDB2,NWRDE2,ICOLAC
C             IN COMMON /COMP/ DO NOT DISTURB THE ORDER OF THE VARIABLES
C                              WHICH ARE EQUIVALENCED TO ARRAYS.
      COMMON/COMP/  DTTRAJ,DTCOLL,DTCOLT,DTPRNT,UVMN2,PSIDMA,TPRINT,DTP,
     1              U1V1SQ,U2V2SQ,DELPSI,DELPST,DELPS2,DELRHO,
     2              PSILM1,PSILM2,PSILM3,PSILM4,PSILM5,PSILM6,PSILM7,
     3              PSILM8,EJJ(4,2),GJJ(4,2),C1OC2,PSCC,PSIR1,PSIR2,
     4             XCMXC1,XCMXC2,YCMYC1,YCMYC2,SPSI1,SPSI2,CPSI1,CPSI2,
     5             XCPI,YCPI,PSII,XCPJ,YCPJ,PSIJ,XCMXC,YCMYC,SPSIJ,
     6             CPSIJ,XFI,XRI,YSI,XFJ,XRJ,YSJ,AKVI,AKVJ,EJ,GJ,
     7             XPJ(4),YPJ(4),ANGYX,SPAN,PSIBPI(4),PSIBPB,PSIBPF,
     8             FNPSIB,PSIBB,PSIB,PSFMPS,SCPSIB,CSPSIB,
     9             RHOBI,RHOBIN(4),PSIBIJ,SPSBIJ,CPSBIJ,XBIJ,YBIJ,PSJTB
      COMMON/COMP/ PSIBPJ,FNPSJB,PSIBJ,RHOBJ,XYJSQR,SPSIB,CPSIB,XBI,YBI,
     1         PRESI,PRESJ,XYSR,DELTA,CRHO,RHOBIC,RHOBMX,RHOBIT,RHOBT,
     2             SPSI21,CPSI21,X2TEM,Y2TEM,XX,YY,PAV,XXYYSR,FN1,SPSF,
     3             CPSF,X1AV,Y1AV,XYAVSR,X2TERM,Y2TERM,SPS21F,CPS21F,
     4             X2AV,Y2AV,VT1AV,VT2AV,VTMVT,FRICT,FNX1,FNY1,FNN1,
     5             FNX2,FNY2,FNN2,SFX1,SFY1,SFN1,SFX2,SFY2,SFN2,
     6              SFX1C,SFX2C,SFY1C,SFY2C,SFN1C,SFN2C,
     7              SFX1T,SFX2T,SFY1T,SFY2T,SFN1T,SFN2T, TCOL,TEND,
     8              TREST1,TREST2,TCOLS1,TCOLS2,P1TEM,P2TEM,U1V1E,U2V2E,
     9              EXTRA(10)
      COMMON/COMPT/ W(8),XWP(8),YWP(8),FLAGW(8),PSIW(8),TQW(8),
     1             TFX,TFY,TMOM,PSIRR,COEF,COEF1,COEF2,TRD2,TRD21,TRD22,
     2             XBMXB,FNUM,A,B,FIZ,FMASS,XC,YC,U,V,PSIC,PSICD,UD2,
     3             SGNU,SGNI,AOMB,CSPSIC,SNPSIC,TRCPSC,TRSPSC,TRPSCD,
     4             XI,XW,YW,SX,SY,S,XPP,YPP,RHO,RHOP,XMUS,XMU,PSI,XNUM,
     5             XDEN,RATIO,ALFA,F,TIF,FC,FCOS,SMAL,FSMX,FS,BETB,FX,FY
     6             ,CSPSI,SNPSI,XCXC,YCYC,SPJ,CPJ,SPIJ,CPIJ,XFJJ,XRJJ,
     7              YSJJ,EJJI,GJJI,XICORJ,YICORJ,NTQ,TBTQ,TETQ,TINCRQ,
     8             NPSF,TBPSF,TEPSF,TINCRP
      COMMON/TAB/  TRHOB(361,2),TROBMX(361,2),TPSIB(361,2),
     1             TCPSIB(361,2),TSPSIB(361,2),TXB1(100),TYB1(100),
     2             TPSB1(100),TPRES1(100)
      DIMENSION   XCMXCI(2),YCMYCI(2),SPSII(2),CPSII(2),PSLM0(8),PSLM(8)
      EQUIVALENCE (XCMXCI(1),XCMXC1),(YCMYCI(1),YCMYC1),(SPSII(1),SPSI1)
     1           ,(CPSII(1),CPSI1),(PSLM0(1),PSLM10),(PSLM(1),PSILM1)
C        COMMON VDICON HAS CONSTANTS USED FOR VEHICLE DAMAGE INDEX
      COMMON/VDICON/EXTF1( 9),EXTR1( 9),EXTB1( 9),PSP1(12),
     2              EXTF2( 9),EXTR2( 9),EXTB2( 9),PSP2(12),NCOL51(10),
     2              NCOL52(10),MMM( 9)
      IF(ISTOP.NE. 0) RETURN
C                 CLEAR TABLE 3
      I3 = 100
      DO 2   IJ = 1,I3
      TXB1(IJ) = 0.0
      TYB1(IJ) = 0.0
      TPSB1(IJ) = 0.0
    2 TPRES1(IJ)= 0.0
      I3 = 0
      INDI = IND1
      INDJ = IND2
C         SEE RESET AT ST 201
      I = 1
      J = 2
      I1= 1
      I2= 7
    5 XCPI = VAR(I1)
      YCPI = VAR(I1 + 1)
      PSII = VAR(I1 +2)
      XCPJ = VAR(I2)
      YCPJ = VAR(I2 +1)
      PSIJ = VAR(I2 + 2)
      XCMXC = XCMXCI(I)
      YCMYC = YCMYCI(I)
      SPSIJ = SPSII(J)
      CPSIJ = CPSII(J)
      XFI   = EJJ(1,I)
      XRI   = EJJ(3,I)
      YSI   = GJJ(1,I)
      XFJ   = EJJ(1,J)
      XRJ   = EJJ(3,J)
      YSJ   = GJJ(1,J)
      AKVI  = AKV(I)
      AKVJ  = AKV(J)
      XFIPAR = 0.15 * XFI
      YSIPAR = 0.36 * YSI
      XFJPAR = 0.15 * XFJ
      YSJPAR = 0.36 * YSJ
      DO 10 IC=1,4
      EJ  = EJJ(IC,J)
      GJ  = GJJ(IC,J)
      XPJ(IC) = XCPJ + EJ *CPSIJ  - GJ *SPSIJ
   10 YPJ(IC) = YCPJ + EJ *SPSIJ  +GJ *CPSIJ
C     CORNER PTS OF VEHICLE J IN SPACE-FIXED SYSTEM, RF 1,LF 2,RR 3,LR 4
      CALL PSBRAN
   80 IF( PSIB - TWOPI) 82,81,81
   81 PSIB = PSIB - TWOPI
      GO TO 80
   82 IF( ABS(PSIB) - DELPST) 83,83,84
   83 PSIB = 0.0
      IPSIB = 1
      PSFMPS = PSIBPF
      GO TO 85
   84 IF( ABS(PSIB-TWOPI) - 0.005) 83,83,840
  840 PSFMPS = PSIBPF - PSIB
   85 IF(PSFMPS) 86,86,88
   86 IF(PSFMPS + PI) 88,88,200
C
   88 RHOBI = TRHOB(IPSIB,I)
C                 NEG. RHOBI FROM TABLE MEANS NO ENTRY YET
      I9 = 0
C      I9 = 1  IS INDICATOR FOR TEMPORARY TRHOB ENTRY (REPORT STEP NINE)
      RHOBMX = TROBMX(IPSIB,I)
  881 IF(RHOBMX) 100,100,89
   89 IF(RHOBI) 90,90,120
   90 RHOBI = RHOBMX
      GO TO 115
  100 IF((PSILM1.LE.PSIB.AND.PSIB.LE.PSILM2) .OR.(PSILM3.LE.PSIB
     X    .AND. PSIB.LE.PSILM4)) GO TO 103
      SCPSIB = 1.0/COS(PSIB)
      RHOBIN(1)  = XFI*SCPSIB
      RHOBIN(2)  = XRI*SCPSIB
      IF((PSILM5.LE.PSIB.AND.PSIB.LE.PSILM6) .OR. (PSILM7.LE.PSIB
     X    .AND. PSIB.LE.PSILM8)) GO TO 105
      RHOBIN(3) = -100.
      RHOBIN(4) = -100.
      GO TO 107
  103 RHOBIN(1) = -100.
      RHOBIN(2) = -100.
  105 CSPSIB =  1.0/SIN(PSIB)
      RHOBIN(3) = YSI * CSPSIB
      RHOBIN(4) = - RHOBIN(3)
  107 RHOBIT= 1.E20
      DO 110 IJ =1,4
      IF(RHOBIN(IJ)) 110,108,108
  108 IF(RHOBIN(IJ) - RHOBIT) 109,110,110
  109 RHOBIT= RHOBIN(IJ)
  110 CONTINUE
      IF(RHOBIT)111,111,112
  111 ISTOP=3
      WRITE(NOUT,5111) T,RHOBIT,PSIB
 5111 FORMAT(5H05111,2X,3H T=,F8.4,5X,7HRHOBIT=,E14.6,2X,6H PSIB=,E14.6)
      GO TO 300
  112 TROBMX(IPSIB,I) = RHOBIT
      RHOBMX = RHOBIT
      IF (RHOBI) 114,114,120
  114 RHOBI = RHOBIT
      TPSIB(IPSIB,I) = PSIB
  115 TRHOB(IPSIB,I) = RHOBI
      I9 = 1
C
  120 PSIBIJ = PSIB + PSII - PSIJ
      CPSBIJ = COS(PSIBIJ)
      SPSBIJ = SIN(PSIBIJ)
      XBIJ  =   YCMYC*SPSIJ + XCMXC*CPSIJ + RHOBI*CPSBIJ
      YBIJ  =   YCMYC*CPSIJ - XCMXC*SPSIJ + RHOBI*SPSBIJ
      IF(XRJ.LT.XBIJ .AND. XBIJ.LT.XFJ .AND. (-YSJ).LT.YBIJ .AND.
     X   YBIJ.LT.YSJ ) GO TO 130
      IF(I9)        122,122,121
  121 TRHOB(IPSIB,I) = -10.0
C           MESSAGE 5121
      I9 = 0
C
C          AT ST 122 INCREMENT PSIB AND IPSIB
  122 IF(IPSIB - IPSIB0 ) 125,123,125
  123 IF(IPSIB0 - NDTAB ) 125,124,124
  124 IPSIB = 1
      PSIB  = 0.0
      PSFMPS = PSIBPF
      GO TO 85
  125 PSIB  = FLOAT(IPSIB) *DELPSI
      IPSIB = IPSIB + 1
      GO TO 80
C
  130 IF(XBIJ) 133,131,133
  131 IF(YBIJ) 133,132,133
  132 PSIBPJ = 0.0
      GO TO 138
  133 PSIBPJ = ATAN2(YBIJ,XBIJ)
  134 IF(PSIBPJ) 135,138,139
  135 PSIBPJ = TWOPI + PSIBPJ
      GO TO 134
  138 NPSJB = 0
      FNPSJB = 0.0
      PSIBJ = 0.0
      IPSJB = 1
C           AT ST 138 PSIBPJ IS ZERO
      GO TO 141
  139 NPSJB = PSIBPJ/DELPSI  + 0.5
      FNPSJB = FLOAT(NPSJB)
      IPSJB = NPSJB + 1
  140 PSIBJ = FNPSJB * DELPSI
 1400 IF(PSIBJ - TWOPI)1402,1401,1401
 1401 PSIBJ = PSIBJ - TWOPI
      GO TO 1400
 1402 IF (ABS(PSIBJ) - DELPST) 1403,1403, 1404
 1403 PSIBJ = 0.0
      IPSJB = 1
      GO TO 141
 1404 IF(ABS(PSIBJ - TWOPI) - 0.005)1403,1403, 141
  141 PSJTB  = TPSIB(IPSJB,J)
      RHOBJ = TRHOB(IPSJB,J)
      XYJSQR = SQRT(XBIJ*XBIJ + YBIJ*YBIJ)
      IPRESZ = 0
      IF(RHOBJ) 149,149,142
  142 IF( ABS(PSJTB -PSIBJ) - DELPST) 145,145,143
  143 ISTOP = 4
      WRITE(NOUT ,5143) T,DELPST,PSIBJ,PSJTB,IPSJB
 5143 FORMAT(7H05143  ,3H T=,F8.4,8H DELPST=,E14.6,7H PSIBJ=,E14.6,
     1   7H PSJTB=,E14.6,7H IPSJB=,I4)
      GO TO 300
  145 TEMP1 = ABS(TSPSIB(IPSJB,J))
      TEMP2 = ABS(TCPSIB(IPSJB,J))
      IF(TEMP1)  1454,1451,1454
 1451 IF(TEMP2)  1454,1452,1454
 1452 ISTOP = 11
      WRITE(NOUT,5145) T,RHOBJ,XYJSQR,PSIBJ,PSJTB,IPSJB
 5145 FORMAT(7H05145  ,3H T=,F8.4,8H RHOBJ =,E14.6,   9H XYJSQR =,E14.6,
     1   7H PSIBJ=,E14.6,   7H PSJTB=,E14.6,  7H IPSJB=,I4)
      GO TO 300
 1454 IF ( TEMP1-TEMP2) 1455,1456,1456
 1455 TEMP3 = (DELRHO + 0.5*DELPS2*RHOBJ*TEMP1 ) / TEMP2
      GO TO 1457
 1456 TEMP3 = (DELRHO + 0.5*DELPS2*RHOBJ*TEMP2 ) / TEMP1
 1457 IF(RHOBJ - XYJSQR + TEMP3) 146,151,151
  146 IF(I9)         148,148,147
  147 TRHOB(IPSIB,I) = - 10.0
      I9 = 0
      GO TO 122
  148 PRESI = 0.0
      PRESJ = 0.0
      IPRES = 0
      IPRESZ = 1
      GO TO 151
C
  149 IF (I9) 150,150,151
  150 TEMP = PSIBJ - PSIBPJ
      IF(ABS(TEMP) -DELPS2) 1500,1500,1499
 1499 TEMP = TEMP + TWOPI
 1500 IF(XBIJ) 1501,1502,1501
 1501 IF(YBIJ) 1503,1502,1503
 1502 TRHOB(IPSJB,J) = XYJSQR
      GO TO 1508
 1503 TEMPYX = YBIJ/XBIJ
      IF(ABS(TEMPYX) - 0.27) 1507,1504,1504
 1504 IF(ABS(TEMPYX) - 1.0) 1505,1505,1506
 1505 IF( TEMP*TEMPYX) 1507,1507,1506
 1506 TRHOB(IPSJB,J) = XYJSQR*(1.0 - TEMP*XBIJ/YBIJ)
      GO TO 1508
 1507 TRHOB(IPSJB,J) = XYJSQR*(1.0 + TEMP*TEMPYX)
 1508 IF(TCPSIB(IPSJB,J)) 1511,1509,1511
 1509 IF(TSPSIB(IPSJB,J)) 1511,1510,1511
 1510 TPSIB(IPSJB,J) = PSIBJ
      TCPSIB(IPSJB,J) = COS(PSIBJ)
      TSPSIB(IPSJB,J) = SIN(PSIBJ)
 1511 J9(IPSJB,J) = -1
  151 CPSIB =  COS(PSIB)
      SPSIB =  SIN(PSIB)
      XBI   =  RHOBI*CPSIB
      YBI   =  RHOBI*SPSIB
      IF (IPRESZ) 152,152,180
  152 IPRES = 1
  153 TEMP1 =  XFI - XBI   + .0001
      IF(TEMP1)1600,161,154
  154 TEMP2 = XBI-XRI   +.0001
      IF(TEMP2)1600,161,155
  155 IF(TEMP1-TEMP2) 1561,1561,156
  156 TEMP1 = TEMP2
 1561 TEMP2 =  YSI - ABS(YBI) + .0001
      IF(TEMP2)1600,161,1562
 1562 IF(INDI) 160,1572,158
 1572 TEMP1 = TEMP2
      GO TO 160
  158 IF(TEMP1 - XFIPAR) 1582,1582,1581
 1581 IF(TEMP2 - YSIPAR ) 1584, 160,160
 1582 IF( TEMP1-TEMP2)   160, 160,1583
 1583 TEMP1 = TEMP2
      GO TO 160
 1584 TEMP1 = TEMP1 *(TEMP2/YSIPAR)
  160 PRESI = AKVI * TEMP1
      GO TO 162
 1600 WRITE(NOUT,5160) T,XFI,XRI,YSI,XBI,YBI,PSIB,PSIBIJ,IPRES,INDI
 5160 FORMAT(22H05160  PRESI TENDS NEG,2X,3H T=,F8.4,5H XFI=,E14.6,
     X5H XRI=,E14.6,5H YSI=,E14.6/34X,6H XBI =,E14.6,18X,6H YBI =,E14.6/
     X 34X,6H PSIB=,E14.6,8H PSIBIJ=,E14.6,7H IPRES=,I4,6H INDI=,I4/
     X  21H        SET PRESI=0.0)
  161 PRESI = 0.0
  162 TEMP1 = XFJ - XBIJ  + .0001
      IF(TEMP1) 170,1700,163
  163 TEMP2 = XBIJ - XRJ     + .0001
      IF(TEMP2) 170,1700,164
  164 IF(TEMP1- TEMP2) 1660,1660,165
  165 TEMP1 = TEMP2
 1660 TEMP2 = YSJ - ABS(YBIJ)   + .0001
      IF(TEMP2) 170,1700,1661
 1661 IF(INDJ) 169,1665,167
 1665 TEMP1 = TEMP2
      GO TO 169
  167 IF(TEMP1 - XFJPAR)  1671,1671,1670
 1670 IF(TEMP2 - YSJPAR)  1673, 169,169
 1671 IF(TEMP1-TEMP2)    169, 169,1672
 1672 TEMP1 = TEMP2
      GO TO 169
 1673 TEMP1 = TEMP1 *(TEMP2/YSJPAR)
  169 PRESJ = AKVJ * TEMP1
      GO TO 1701
  170 WRITE(NOUT,5170) T,XFJ,XRJ,YSJ,XBIJ,YBIJ,PRESI,PSIB,PSIBIJ,IPRES,
     X INDJ
 5170 FORMAT(22H05170  PRESJ TENDS NEG,2X,3H T=,F8.4,5H XFJ=,E14.6,
     X5H XRJ=,E14.6,5H YSJ=,E14.6/34X,6H XBIJ=,E14.6,18X,6H YBIJ=,E14.6,
     X 2X,7H PRESI=,E14.6/
     X 34X,6H PSIB=,E14.6,8H PSIBIJ=,E14.6,7H IPRES=,I4,6H INDJ=,I4/
     X  21H        SET PRESJ=0.0)
C       OMIT FORMER STOP
C     GO TO 300
 1700 PRESJ = 0.0
 1701 IF(PRESI + ALAMB - PRESJ) 1704,180,1703
 1703 PRESI = PRESJ
      GO TO 180
 1704 IF((ABS(AKVJ/AKVI) - 1.25) - 0.75) 1705,1705,1706
 1705 TEMP3 = DELRHO
      GO TO 172
 1706 TEMP1 = (PRESJ-PRESI-0.0001*(AKVJ-AKVI))/((AKVI+AKVJ)*DELRHO)
      ITEMP2= TEMP1 - 0.5
C              ROUND TO ONE LESS THAN NEAREST INTEGER
C            TEMP1 SHOULD ALWAYS BE GREATER THAN 0.5
      TEMP2 = FLOAT (ITEMP2)
      TEMP3 = (TEMP2 + 0.5) * DELRHO
  172 XBI = XBI - TEMP3  * CPSIB
      YBI = YBI - TEMP3  * SPSIB
      XBIJ =  XBIJ - TEMP3  * CPSBIJ
      YBIJ =  YBIJ - TEMP3  * SPSBIJ
C     IF(IPRES -150)  174,173,173
      IF(IPRES -200)  174,173,173
  173 ISTOP=7
      WRITE(NOUT,5173) T,PSIB,XBI,YBI,XBIJ,YBIJ,PRESI,PRESJ,IPRES
 5173 FORMAT(5H05173,2X,F8.4,5X,7E14.6,I4)
      GO TO 300
  174 IPRES = IPRES + 1
      GO TO 153
C
C
C             TABLE 3 HAS  FOUR ARRAYS,TXB1,TYB1,TPSB1,TPRES1
  180 I3 = I3 + 1
      IF( I3 - 100) 1801,1801,1800
 1800 ISTOP = 9
      I3P = I3 - 1
      WRITE(NOUT,5030) T,IND1,IND2,    I3P,(TPSB1(IJ),IJ=1,I3P)
 5030 FORMAT(5H05030,1X,3H T=,F8.4,7H, IND1=,I4,7H, IND2=,I4,
     X  6H,  I3=,I4,16H,TPSB1 AS STORED / (1X,10E13.5/))
      WRITE(NOUT,5031)    (TXB1(IJ),IJ=1,I3P)
 5031 FORMAT(5H 5031,10X, 6H  TXB1/(1X,10E13.5/))
      WRITE(NOUT,5032)    (TYB1(IJ),IJ=1,I3P)
 5032 FORMAT(5H 5032,10X, 6H  TYB1/(1X,10E13.5/))
      WRITE(NOUT,5033)   (TPRES1(IJ),IJ=1,I3P)
 5033 FORMAT(5H 5033,10X, 6HTPRES1/(1X,10E13.5/))
      GO TO 300
 1801 CONTINUE
      IF(I-1) 181,181,182
  181 TXB1(I3) = XBI
      TYB1(I3) = YBI
      TPSB1(I3) = PSIB
      TPRES1(I3) = PRESI
      GO TO 183
  182 TXB1(I3) = XBIJ
      TYB1(I3) = YBIJ
      IF(XBIJ) 1823,1821,1823
 1821 IF(YBIJ) 1823,1822,1823
 1822 PSIBPJ = 0.0
      GO TO 1826
 1823 PSIBPJ = ATAN2(YBIJ,XBIJ)
 1824 IF(PSIBPJ)  1825,1826,1826
 1825 PSIBPJ = TWOPI + PSIBPJ
      GO TO 1824
 1826 TPSB1(I3) = PSIBPJ
      TPRES1(I3) = PRESJ
  183 XYSR =  SQRT(XBI*XBI + YBI*YBI)
      IF (J9(IPSIB,I)) 190,184,184
  184 DELTA = RHOBMX - XYSR
      IF(DELTA) 185,185,186
  185 CRHO = 0.0
      RHOBIC = RHOBMX
      GO TO 192
  186 IF(DELTA-C1OC2)  187,190,190
  187 CRHO = C0 + DELTA*(-C1 + C2*DELTA)
  189 RHOBIC = CRHO * RHOBMX  +  (1.0-CRHO)* XYSR
      GO TO 192
  190 CRHO = 0.0
      RHOBIC = XYSR
  192 IF(RHOBIC) 193,193,194
  193 ISTOP=10
      WRITE(NOUT,5193) T,RHOBIC,PSIB
 5193 FORMAT(5H05193,2X,3H T=,F8.4,5X,7HRHOBIC=,E14.6,2X,6H PSIB=,E14.6)
      GO TO 300
  194 RHOBT = TRHOB(IPSIB,I)
      IF(RHOBT) 197,197,195
  195 IF(RHOBIC - RHOBT) 197,198,198
  197 TRHOB(IPSIB,I) = RHOBIC
  198 I9 = 0
      TCPSIB(IPSIB,I)= CPSIB
      TSPSIB(IPSIB,I)= SPSIB
      GO TO 122
C
C      AT STATEMENT 200 INTERCHANGE VEHICLES I AND J AND RETEST
  200 IF(I-1) 201,201,202
  201 I=2
      J=1
      I1 = 7
      I2 = 1
      INDI = IND2
      INDJ = IND1
      GO TO 5
C
C
  202 IF (I3) 203 ,240,203
  203 CALL TORDER( I3,IB1,IF1,TPSB1,TXB1,TYB1,TPRES1)
  210 CPSI21 =  CPSI2 * CPSI1  +  SPSI2 * SPSI1
      SPSI21 =  SPSI2 * CPSI1  -  CPSI2 * SPSI1
      X2TEM  = YCMYC1 * SPSI2  + XCMXC1 * CPSI2
      Y2TEM  =  YCMYC1 * CPSI2  - XCMXC1 * SPSI2
      IB = IB1
      IL = I3 - 1
  211 DO 220 IJ = IB,IL
      IF(I3-1) 212,2131,212
  212 IF(IB-I3) 2131,213,2131
  213 IJ1 = 1
      GO TO 2132
 2131 IJ1 = IJ + 1
 2132 XX = TXB1(IJ) -TXB1(IJ1)
      YY = TYB1(IJ)- TYB1(IJ1)
      PAV = 0.5 * (TPRES1(IJ) + TPRES1(IJ1))
      XXYYSR  = SQRT(XX*XX + YY*YY)
      FN1 = PAV * XXYYSR
      CPSF =  XX/XXYYSR
      SPSF =  YY/XXYYSR
C
      X1AV =  0.5 *(TXB1(IJ) + TXB1(IJ1))
      Y1AV =  0.5 *(TYB1(IJ) + TYB1(IJ1))
      X2TERM = X1AV * CPSI21 + Y1AV * SPSI21
      Y2TERM =  Y1AV * CPSI21 - X1AV * SPSI21
      CPS21F =  CPSI21 * CPSF   +  SPSI21 * SPSF
      SPS21F =  SPSI21 * CPSF   -  CPSI21 * SPSF
      X2AV = X2TEM  + X2TERM
      Y2AV = Y2TEM  + Y2TERM
      VT1AV = CPSF *(U1 - Y1AV*PSI1D )  +  SPSF *(V1 + X1AV*PSI1D )
      VT2AV = CPS21F*(U2- Y2AV*PSI2D ) - SPS21F *(V2 + X2AV*PSI2D )
      VTMVT =  VT2AV - VT1AV
      IF(ABS(VTMVT) - ZETAV) 214,215,215
  214 FRICT = AMU * (VTMVT/ZETAV)
      GO TO 216
  215 FRICT = SIGN(AMU,VTMVT)
  216 FNX1 =  FN1  * (SPSF + FRICT*CPSF)
      FNY1 =  FN1  * (FRICT*SPSF - CPSF)
      FNN1 = -FNX1*Y1AV  + FNY1* X1AV
      FNX2 = -FNX1*CPSI21 - FNY1 * SPSI21
      FNY2 =  FNX1*SPSI21 - FNY1 * CPSI21
      FNN2 = -FNX2*Y2AV   + FNY2 * X2AV
C
      SFX1C = SFX1C + FNX1
      SFY1C = SFY1C + FNY1
      SFN1C = SFN1C + FNN1
      SFX2C = SFX2C + FNX2
      SFY2C = SFY2C + FNY2
      SFN2C = SFN2C + FNN2
  220 CONTINUE
      IF(IB-1) 240,240,221
  221 IF(IB-I3) 222,223,222
  222 IB=I3
      IL=I3
      GO TO 211
  223 IB=1
      IL=IF1-1
      GO TO 211
  240 RETURN
  300 WRITE(NOUT,301) T,ISTOP
  301 FORMAT( 9H0 STOP AT,F9.4,12H SEC, ISTOP=,I3)
      RETURN
      END
      SUBROUTINE PSBRAN
C      SIMULATION MODEL OF AUTOMOBILE COLLISIONS -SMAC
C         RANGE OF CLOCKWISE ANGULAR SWEEP FOR VEHICLE I
C      RETURNS PSIBPB(BEGIN SWEEP) AND PSIBPF(FINISH SWEEP)
C      RETURNS PSIB TO BEGIN AND IPSIB INDEX
      COMMON/CONST/ G,RAD,PI,TWOPI,PIO2,PI32,ND2,ND4,ND8,NIN,NOUT
      COMMON/INTG/NEQ,T,DT,VAR(12),DER(12)
      EQUIVALENCE (VAR(1),XCP1),(VAR(2),YCP1),(VAR(3),PSI1),
     1            (VAR(4),PSI1D),(VAR(5),U1),(VAR(6),V1),
     2            (VAR(7),XCP2),(VAR(8),YCP2),(VAR(9),PSI2),
     3            (VAR(10),PSI2D),(VAR(11),U2),(VAR(12),V2)
      EQUIVALENCE (DER(1),DXCP1),(DER(2),DYCP1),(DER(3),DPSI1),
     1            (DER(4),DPSI1D),(DER(5),DU1),(DER(6),DV1),
     2            (DER(7),DXCP2),(DER(8),DYCP2),(DER(9),DPSI2),
     3            (DER(10),DPSI2D),(DER(11),DU2),(DER(12),DV2)
      COMMON/INPT/  T0,TF,DTTRA0,DTCOL0,DTCLT0,DTPRN0,UVMIN,PSIDMN,FVEH0
     1             ,XCP10,YCP10,PSI10,PSI1D0,U10,V10,
     2              XCP20,YCP20,PSI20,PSI2D0,U20,V20,
     3              A1,B1,TR1,FIZ1,FM1,PSIR10,XF1,XR1,YS1,
     4              A2,B2,TR2,FIZ2,FM2,PSIR20,XF2,XR2,YS2,
     5              CSTFI(8),TBTQ1,TETQ1,TINCQ1,NTBLQ1,NTQ1,
     6              TBTQ2,TETQ2,TINCQ2,NTBLQ2,NTQ2,TII(8,201),
     7              TBPSF1,TEPSF1,TINCP1,NTBLP1,NPSF1,
     8              TBPSF2,TEPSF2,TINCP2,NTBLP2,NPSF2,PSIFI(4,201),
     9              XBP(2),YBP(2),XMU1,XMU2,CMU
      COMMON/INPT/  DELPS0,DELRO0,ALAMB,ZETAV,AKV(2) ,AMU,C0,C1,C2,
     1              PSLM10,PSLM20,PSLM30,PSLM40,PSLM50,PSLM60,PSLM70,
     2              PSLM80,HED(40),DADE(3),XINPUT(9)
      COMMON/INTGR/JCC(4),JCOR(4),NPSIB,IPSIB0,IPSIB,IBB,IFF,NDTAB,
     1             I9,J9(361,2),  NPSJB,IPSJB,I3,ILAST,IL,IND1,IND2,INDI
     2             ,INDJ,ISTOP,ITZER1,ITZER2,IPZER1,IPZER2,ICOUNT,INDXB,
     3             ICOLLP,ICOLL,IQ,IND,IVEH,LL,ICTVDI,ITCOL,ITFLG1,
     4             ITFLG2,NWRDB1,NWRDE1,NWRDB2,NWRDE2,ICOLAC
C             IN COMMON /COMP/ DO NOT DISTURB THE ORDER OF THE VARIABLES
C                              WHICH ARE EQUIVALENCED TO ARRAYS.
      COMMON/COMP/  DTTRAJ,DTCOLL,DTCOLT,DTPRNT,UVMN2,PSIDMA,TPRINT,DTP,
     1              U1V1SQ,U2V2SQ,DELPSI,DELPST,DELPS2,DELRHO,
     2              PSILM1,PSILM2,PSILM3,PSILM4,PSILM5,PSILM6,PSILM7,
     3              PSILM8,EJJ(4,2),GJJ(4,2),C1OC2,PSCC,PSIR1,PSIR2,
     4             XCMXC1,XCMXC2,YCMYC1,YCMYC2,SPSI1,SPSI2,CPSI1,CPSI2,
     5             XCPI,YCPI,PSII,XCPJ,YCPJ,PSIJ,XCMXC,YCMYC,SPSIJ,
     6             CPSIJ,XFI,XRI,YSI,XFJ,XRJ,YSJ,AKVI,AKVJ,EJ,GJ,
     7             XPJ(4),YPJ(4),ANGYX,SPAN,PSIBPI(4),PSIBPB,PSIBPF,
     8             FNPSIB,PSIBB,PSIB,PSFMPS,SCPSIB,CSPSIB,
     9             RHOBI,RHOBIN(4),PSIBIJ,SPSBIJ,CPSBIJ,XBIJ,YBIJ,PSJTB
      COMMON/COMP/ PSIBPJ,FNPSJB,PSIBJ,RHOBJ,XYJSQR,SPSIB,CPSIB,XBI,YBI,
     1         PRESI,PRESJ,XYSR,DELTA,CRHO,RHOBIC,RHOBMX,RHOBIT,RHOBT,
     2             SPSI21,CPSI21,X2TEM,Y2TEM,XX,YY,PAV,XXYYSR,FN1,SPSF,
     3             CPSF,X1AV,Y1AV,XYAVSR,X2TERM,Y2TERM,SPS21F,CPS21F,
     4             X2AV,Y2AV,VT1AV,VT2AV,VTMVT,FRICT,FNX1,FNY1,FNN1,
     5             FNX2,FNY2,FNN2,SFX1,SFY1,SFN1,SFX2,SFY2,SFN2,
     6              SFX1C,SFX2C,SFY1C,SFY2C,SFN1C,SFN2C,
     7              SFX1T,SFX2T,SFY1T,SFY2T,SFN1T,SFN2T, TCOL,TEND,
     8              TREST1,TREST2,TCOLS1,TCOLS2,P1TEM,P2TEM,U1V1E,U2V2E,
     9              EXTRA(10)
      COMMON/COMPT/ W(8),XWP(8),YWP(8),FLAGW(8),PSIW(8),TQW(8),
     1             TFX,TFY,TMOM,PSIRR,COEF,COEF1,COEF2,TRD2,TRD21,TRD22,
     2             XBMXB,FNUM,A,B,FIZ,FMASS,XC,YC,U,V,PSIC,PSICD,UD2,
     3             SGNU,SGNI,AOMB,CSPSIC,SNPSIC,TRCPSC,TRSPSC,TRPSCD,
     4             XI,XW,YW,SX,SY,S,XPP,YPP,RHO,RHOP,XMUS,XMU,PSI,XNUM,
     5             XDEN,RATIO,ALFA,F,TIF,FC,FCOS,SMAL,FSMX,FS,BETB,FX,FY
     6             ,CSPSI,SNPSI,XCXC,YCYC,SPJ,CPJ,SPIJ,CPIJ,XFJJ,XRJJ,
     7              YSJJ,EJJI,GJJI,XICORJ,YICORJ,NTQ,TBTQ,TETQ,TINCRQ,
     8             NPSF,TBPSF,TEPSF,TINCRP
      COMMON/TAB/  TRHOB(361,2),TROBMX(361,2),TPSIB(361,2),
     1             TCPSIB(361,2),TSPSIB(361,2),TXB1(100),TYB1(100),
     2             TPSB1(100),TPRES1(100)
      DIMENSION   XCMXCI(2),YCMYCI(2),SPSII(2),CPSII(2),PSLM0(8),PSLM(8)
      EQUIVALENCE (XCMXCI(1),XCMXC1),(YCMYCI(1),YCMYC1),(SPSII(1),SPSI1)
     1           ,(CPSII(1),CPSI1),(PSLM0(1),PSLM10),(PSLM(1),PSILM1)
      DO 22 IC=1,4
      JCC(IC) = 0
      JCOR(IC) = IC
      TEMPX  =  XPJ(IC)- XCPI
      TEMPY  =  YPJ(IC)- YCPI
      IF(TEMPX) 13,11,13
   11 IF(TEMPY) 13,12,13
   12 ANGYX = 0.0
      JCC(IC) = IC
      GO TO 17
   13 ANGYX = ATAN2(TEMPY,TEMPX)
   17 TEMPSI = ANGYX - PSII
      IF (TEMPSI) 19,22,20
   19 TEMPSI = TWOPI + TEMPSI
      IF (TEMPSI) 19,22,22
   20 IF (TEMPSI - TWOPI) 22,22,21
   21 TEMPSI = TEMPSI - TWOPI
      GO TO 20
   22 PSIBPI(IC) = TEMPSI
      ILAST = 4
   32 ABIG  =  -1.E20
      DO 35  II = 1,ILAST
      IF( PSIBPI(II) - ABIG) 35,34,34
   34 ABIG = PSIBPI(II)
      IBIG = II
   35 CONTINUE
      IF(IBIG-ILAST) 36,38,38
   36 TEMPSI = PSIBPI(ILAST)
      ITEMP  = JCOR(ILAST)
      PSIBPI(ILAST) = ABIG
      JCOR(ILAST)   = JCOR(IBIG)
      PSIBPI(IBIG)  = TEMPSI
      JCOR(IBIG)    = ITEMP
   38 ILAST = ILAST - 1
      IF(ILAST-1) 39,39,32
   39 IBB = 1
      IFF = 4
      SPAN = PI
      IF(PSIBPI(4) - PI) 70,70,41
   41 IF(PSIBPI(1) - PI) 43,70,70
   43 IF(PSIBPI(1) - PIO2) 47,44,44
   44 IF(PSIBPI(4) - PI32) 70,70,45
   45 SPAN = PI32
      GO TO 70
   47 IF(PSIBPI(4) - PI32) 48,48,49
   48 SPAN = PI32
      GO TO 70
   49 IF(PSIBPI(2) - PI) 53,50,50
   50 IBB = 2
      IFF = 1
      SPAN = PI32
      GO TO 70
   53 IF(PSIBPI(3) - PI) 54,54,57
   54 IBB = 4
      IFF = 3
      SPAN = PI32
      GO TO 70
   57 IF(PSIBPI(3) - PI32) 61,58,58
   58 IBB = 3
      IFF = 2
      SPAN = PI32
      GO TO 70
   61 IF(ABS(PSIBPI(3)-PSIBPI(2)) - ABS(PSIBPI(1)+TWOPI-PSIBPI(4))) 62,
     X  62,65
   62 SPAN = TWOPI
      GO TO 70
   65 IBB = 3
      IFF = 2
      SPAN = TWOPI
   70 PSIBPB = PSIBPI(IBB)
      PSIBPF = PSIBPI(IFF)
      IF(PSIBPF + DELPSI - TWOPI) 71,700,700
  700 PSIBPF = 0.0
   71 NPSIB =  PSIBPB/DELPSI  +0.5
      FNPSIB = FLOAT(NPSIB)
      IF (NPSIB) 73,72,73
   72 PSIBB = FLOAT(NDTAB-1) *DELPSI
      IPSIB0 = NDTAB
      GO TO 74
   73 PSIBB = (FNPSIB - 1.) * DELPSI
      IPSIB0 = NPSIB
   74 PSIB =  PSIBB
      IPSIB = IPSIB0
      RETURN
      END
      SUBROUTINE TORDER(NPT,IBB,IFF,TAB,TB1,TB2,TB3)
C          ACCIDENT RECONSTRUCTION - COMBINES TRAJECTORY AND COLLISION
C      SIMULATION MODEL OF AUTOMOBILE COLLISIONS -SMAC
      COMMON/CONST/ G,RAD,PI,TWOPI,PIO2,PI32,ND2,ND4,ND8,NIN,NOUT
      DIMENSION TAB(1),TB1(1),TB2(1),TB3(1)
C
C        TAB HAS ANGLE VALUES IN RADIANS FROM ZERO TO LESS THAN TWOPI
C          IN NO SPECIAL ORDER.
C        THIS SUBROUTINE ORDERS TAB FOR INCREASING VALUES,AND ARRANGES
C           THE CORRESPONDING VALUES IN TB1,TB2 AND TB3 TO CORRESPOND TO
C           THE NEW ORDER OF TAB..
C        THEN THE INDICES FOR CLOCKWISE SWEEP IN TAB ARE FOUND
C        IBB FOR BEGINNING, IFF FOR FINISH.
C        ALL THE TABLES ARE HANDLED IN PLACE, THAT IS, THE ORDER IS
C           CHANGED IN THE ORIGINAL STORAGE LOCATIONS.
C
C
      ILAST = NPT
   10 ABIG = -1. E20
      DO 14 I=1,ILAST
      IF(TAB(I) - ABIG) 14,12,12
   12 ABIG = TAB(I)
      IBIG = I
   14 CONTINUE
      IF(IBIG - ILAST) 16,18,18
   16 TABTEM = TAB(ILAST)
      TB1TEM = TB1(ILAST)
      TB2TEM = TB2(ILAST)
      TB3TEM = TB3(ILAST)
      TAB(ILAST) = ABIG
      TB1(ILAST) = TB1(IBIG)
      TB2(ILAST) = TB2(IBIG)
      TB3(ILAST) = TB3(IBIG)
      TAB(IBIG) = TABTEM
      TB1(IBIG) = TB1TEM
      TB2(IBIG) = TB2TEM
      TB3(IBIG) = TB3TEM
   18 ILAST = ILAST - 1
      IF(ILAST-1) 19,19,10
   19 IBB = 1
      IFF = NPT
      SPAN = PI
      IF(TAB(NPT) - PI) 70,70,41
   41 IF(TAB(1) - PI) 43,70,70
   43 IF(TAB(1) - PIO2) 47,44,44
   44 IF(TAB(NPT) - PI32) 70,70,45
   45 SPAN = PI32
      GO TO 70
C
   47 IF(TAB(NPT) - PI32) 48,48,49
   48 SPAN = PI32
      GO TO 70
   49 IPI1 = 0
      IPI2 = 0
      DO 51 I=1,NPT
      IF(TAB(I) - PI) 51,50,50
   50 IPI1 = I-1
      GO TO 52
   51 CONTINUE
   52 IF(IPI1) 70,70,53
   53 IPI2 = IPI1 + 1
      IF ( IPI2-NPT) 54,70,70
   54 IF(TAB(IPI2) - PI32) 59,58,58
   58 IBB = IPI2
      IFF = IPI1
      SPAN = PI32
      GO TO 70
   59 IF(TAB(IPI1) - PIO2) 60,60,61
   60 IBB = IPI2
      IFF = IPI1
      SPAN = PI32
      GO TO 70
   61 IF(ABS(TAB(IPI2)-TAB(IPI1))-ABS(TAB(1)+TWOPI-TAB(NPT)))62,62,65
   62 SPAN = TWOPI
      GO TO 70
   65 IBB = IPI2
      IFF = IPI1
      SPAN = TWOPI
   70 RETURN
      END
      SUBROUTINE SETIND(PS1,PS2,XMX,YMY,PSC1,PSC2,IN1,IN2)
C      SIMULATION MODEL OF AUTOMOBILE COLLISIONS -SMAC
C            SET INDICATORS TO OMIT THOSE SURFACES THAT ARE WITHIN
C       + OR - 0.10 RAD     OF BEING PARALLEL TO THE LINE CONNECTING THE
C            CENTERS OF GRAVITY OF THE VEHICLES.
C        SAMPLE CALL
C     CALL SETIND(PSI1,PSI2,XCMXC1,YCMYC1, PSCC1,PSCC2,IND1,IND2)
C
      DATA PI/ 3.141592653/, TWOPI/6.2831853072/
      IF(XMX) 13,11,13
   11 IF(YMY) 13,12,13
   12 PSC1 = 0.0
      PSC2 = 0.0
      GO TO 16
   13 PSC1 = ATAN2(-YMY,-XMX)
      PSC2 = ATAN2( YMY, XMX)
   16 TEMP1 = ABS(PSC1- PS1)
  161 IF(TEMP1 - PI) 17,17,162
  162 TEMP1 = ABS(TWOPI-TEMP1)
      GO TO 161
   17 IF((TEMP1.LE.0.10) .OR. (TEMP1.GE.3.04)) GO TO 18
      IF( TEMP1.GE.0.88 .AND.TEMP1.LE.2.62) GO TO 20
      IN1 =  1
      GO TO 22
   18 IN1 = - 1
      GO TO 22
   20 IN1 = 0
C      IN1 =-1 END ONLY,  =0 SIDE ONLY,  =1 END AND SIDE
C      IN2 =-1 END ONLY,  =0 SIDE ONLY,  =1 END AND SIDE
   22 TEMP1 = ABS(PSC2- PS2)
  221 IF(TEMP1 - PI) 23,23,222
  222 TEMP1 = TWOPI - TEMP1
      GO TO 221
   23 IF((TEMP1.LE.0.10) .OR. (TEMP1.GE.3.04)) GO TO 30
      IF( TEMP1.GE.0.88 .AND.TEMP1.LE.2.62) GO TO 32
      IN2 = 1
      GO TO 34
   30 IN2 = -1
      GO TO 34
   32 IN2 = 0
   34 RETURN
      END